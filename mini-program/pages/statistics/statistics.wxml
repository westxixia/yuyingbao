<view class="container">
  <!-- 时间范围选择 -->
  <view class="time-range-selector">
    <view class="range-tabs">
      <view class="range-tab {{currentRange === 'week' ? 'active' : ''}}" bindtap="setTimeRange" data-range="week">
        本周
      </view>
      <view class="range-tab {{currentRange === 'month' ? 'active' : ''}}" bindtap="setTimeRange" data-range="month">
        本月
      </view>
      <view class="range-tab {{currentRange === 'quarter' ? 'active' : ''}}" bindtap="setTimeRange" data-range="quarter">
        本季度
      </view>
    </view>
    
    <!-- 时间范围显示 -->
    <view class="time-range-display" wx:if="{{currentRange === 'month'}}">
      <text class="range-text">📅 本月数据按周统计，更清晰展示趋势</text>
    </view>
    <view class="time-range-display" wx:if="{{currentRange === 'quarter'}}">
      <text class="range-text">📈 本季度数据按月统计，便于观察成长趋势</text>
    </view>
  </view>

  <!-- 喂养统计 -->
  <view class="card feeding-stats">
    <view class="card-header">
      <text class="card-title">喂养统计</text>
      <text class="card-subtitle">{{feedingStats.totalAmount}}ml / {{feedingStats.totalCount}}次</text>
    </view>
    
    <view class="stats-grid">
      <view class="stat-item">
        <view class="stat-value primary-color">{{feedingStats.avgAmount}}ml</view>
        <view class="stat-label">平均每次</view>
      </view>
      <view class="stat-item">
        <view class="stat-value secondary-color">{{feedingStats.avgDaily}}ml</view>
        <view class="stat-label">日均量</view>
      </view>
      <view class="stat-item">
        <view class="stat-value warning-color">{{feedingStats.avgFrequency}}次</view>
        <view class="stat-label">日均次数</view>
      </view>
    </view>
    
    <!-- 喂养趋势图 -->
    <view class="chart-container">
      <view class="chart-title">喂养趋势</view>
      <view class="chart">
        <view class="chart-bars">
          <view class="chart-bar" wx:for="{{feedingChart}}" wx:key="date">
            <view class="bar" style="height: {{item.height}}%">
              <view class="bar-tooltip">{{item.amount}}ml</view>
            </view>
            <view class="bar-label">{{item.label}}</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 大便统计 -->
  <view class="card diaper-stats">
    <view class="card-header">
      <text class="card-title">大便统计</text>
      <text class="card-subtitle">{{diaperStats.totalCount}}次</text>
    </view>
    
    <view class="stats-grid">
      <view class="stat-item">
        <view class="stat-value primary-color">{{diaperStats.avgDaily}}次</view>
        <view class="stat-label">日均次数</view>
      </view>
      <view class="stat-item">
        <view class="stat-value secondary-color">{{diaperStats.normalRate}}%</view>
        <view class="stat-label">正常比例</view>
      </view>
    </view>
    
    <!-- 大便性状分布 -->
    <view class="chart-container">
      <view class="chart-title">性状分布</view>
      <view class="pie-chart">
        <view class="pie-segment" wx:for="{{diaperPieChart}}" wx:key="type" style="transform: rotate({{item.startAngle}}deg); background: conic-gradient({{item.color}} 0deg {{item.angle}}deg, transparent {{item.angle}}deg);">
        </view>
        <view class="pie-center">
          <text class="pie-total">{{diaperStats.totalCount}}</text>
        </view>
      </view>
      <view class="pie-legend">
        <view class="legend-item" wx:for="{{diaperPieChart}}" wx:key="type">
          <view class="legend-color" style="background: {{item.color}}"></view>
          <text class="legend-text">{{item.type}} ({{item.count}})</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 成长统计 -->
  <view class="card growth-stats" wx:if="{{growthStats.hasData}}">
    <view class="card-header">
      <text class="card-title">成长统计</text>
      <text class="card-subtitle">身高{{growthStats.latestHeight}}cm / 体重{{growthStats.latestWeight}}kg</text>
    </view>
    
    <view class="stats-grid">
      <view class="stat-item">
        <view class="stat-value primary-color">{{growthStats.heightGain}}cm</view>
        <view class="stat-label">身高增长</view>
      </view>
      <view class="stat-item">
        <view class="stat-value secondary-color">{{growthStats.weightGain}}kg</view>
        <view class="stat-label">体重增长</view>
      </view>
      <view class="stat-item">
        <view class="stat-value warning-color">{{growthStats.avgWeightGain}}kg/月</view>
        <view class="stat-label">月均增重</view>
      </view>
    </view>
    
    <!-- 成长曲线图 -->
    <view class="chart-container">
      <view class="chart-title">成长曲线</view>
      <view class="growth-chart">
        <view class="chart-line">
          <view class="data-point" wx:for="{{growthChart}}" wx:key="date" style="left: {{item.x}}%; top: {{item.y}}%">
            <view class="point-tooltip">
              <text>{{item.date}}</text>
              <text>身高: {{item.height}}cm</text>
              <text>体重: {{item.weight}}kg</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 智能分析 -->
  <view class="card analysis">
    <view class="card-header">
      <text class="card-title">智能分析</text>
    </view>
    
    <view class="analysis-items">
      <view class="analysis-item" wx:for="{{analysis}}" wx:key="*this">
        <view class="analysis-icon">{{item.icon}}</view>
        <view class="analysis-content">
          <text class="analysis-title">{{item.title}}</text>
          <text class="analysis-desc">{{item.description}}</text>
        </view>
        <view class="analysis-status {{item.status}}">{{item.statusText}}</view>
      </view>
    </view>
  </view>
</view>
